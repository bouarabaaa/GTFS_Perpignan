<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>L'âme de Perpignan</title>
    <link rel="stylesheet" href="/public/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <h1>L'âme de Perpignan</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="#accueil">Accueil</a></li>
                    <li><a href="#fonctionnalites">Fonctionnalités</a></li>
                    <li><a href="#itineraire">Itinéraire</a></li>
                    <li><a href="#decouvrir">Découvrir</a></li>
                    <li><a href="#contact">Contact</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <section id="accueil" class="hero">
            <h1>L'âme de Perpignan</h1>

            <div class="categories-container">
                <div class="category-card">
                    <div class="icon">
                        <img src="/public/images/icon-catalane.png" alt="Culture catalane">
                    </div>
                    <h3 class="red-title">Culture catalane</h3>
                    <p>Culture catalane</p>
                </div>

                <div class="category-card">
                    <div class="icon">
                        <img src="/public/images/icon-mediterranee.png" alt="Ambiance méditerranéenne">
                    </div>
                    <h3 class="red-title">Ambiance méditerranéenne</h3>
                    <p>Ambiance méditerranéenne</p>
                </div>

                <div class="category-card">
                    <div class="icon">
                        <img src="/public/images/icon-patrimoine.png" alt="Patrimoine historique">
                    </div>
                    <h3 class="red-title">Patrimoine historique</h3>
                    <p>Patrimoine historique</p>
                </div>
            </div>
        </section>

        <section id="fonctionnalites" class="features">
            <h2>Fonctionnalités de l'app</h2>

            <div class="features-container">
                <div class="feature">
                    <div class="feature-icon">
                      <i class="fas fa-desktop fa-3x " style=" font-size: 50px; color: #a0552a;"></i>
                        <!-- <img src="/public/images/icon-interface.png" alt="Interface simple"> -->
                    </div>
                    <p>Interface simple</p>
                </div>

                <div class="feature">
                    <div class="feature-icon">
                        <!-- <img src="/public/images/icon-donnees.png" alt="Données locales"> -->
                        <i class="fas fa-map-marker-alt fa-3x " style=" font-size: 50px; color: #a0552a;"></i>
                    </div>
                    <p>Navigation intuitive</p>
                </div>

                <div class="feature">
                    <div class="feature-icon ">
                      <i class="fas fa-network-wired  " style=" font-size: 50px; color: #a0552a;"></i>
                    </div>
                    <p>Services connectés au territoire</p>
                </div>
            </div>

            <div class="map-container">
                <div class="map-label">PERPIGNAN</div>
            </div>
        </section>

        <section id="itineraire" class="route-planner">
            <h2>Planifiez votre itinéraire</h2>

            <div class="route-form">
                <div class="input-group">
                    <label for="depart">Station de départ</label>
                    <input class="inps" list="dataSet" id="depart"   placeholder="Commencez à écrire..." value="">

                    <!-- <select type="text" id="depart" placeholder="Saisissez votre point de départ"></select> -->
                </div>

                <div class="input-group">
                    <label for="arrivee">Station d'arrivée</label>
                    <input class="inps" list="dataSet" id="arrivee"   placeholder="Commencez à écrire..." value="">

                    <!-- <select type="text" id="arrivee" placeholder="Saisissez votre destination"></select> -->
                </div>

                <div class="input-group">
                    <label for="intermediaire">Stations intermédiaires</label>
                    <input class="inps" list="dataSet" id="intermediaire"   placeholder="Commencez à écrire..." value="">
                    <!-- <select type="text" placeholder="Stations intermédiaires (facultatif)"></select> -->
                </div>

                <div class="input-group">
                    <label for="eviter">Stations à éviter</label>
                    <input class="inps" list="dataSet" id="eviter"   placeholder="Commencez à écrire..." value="">

                    <!-- <select type="text" id="eviter" placeholder="Stations à éviter (facultatif)"></select> -->
                </div>

                <button type="submit" class="submit-btn" onclick="trouverChemin()">Rechercher</button>
                <!--<button onclick="trouverChemin()">Trouver</button> -->
                <datalist id="dataSet"></datalist>
            </div>
            <div id="chemin" class="show">
                <template id="oneItems">
                    <li class="listeItems">
                      <div class="spansTem">
                          <span class="bool1"></span>
                          <span class="bool2"></span>
                      </div>
                      <p></p>
                    </li>
                </template>
                
            </div>
        </section>

        <section id="decouvrir" class="discover">
            <h2>Découvrir Perpignan</h2>

            <div class="discover-grid">
                <div class="discover-card">
                    <img src="/public/images/perpignan-castle.png" alt="Château de Perpignan">
                    <h3>Le Palais des Rois de Majorque</h3>
                    <p>Découvrez ce palais-forteresse du XIIIe siècle qui témoigne du passé royal de la ville.</p>
                </div>

                <div class="discover-card">
                    <img src="/public/images/perpignan-cathedral.png" alt="Cathédrale de Perpignan">
                    <h3>La Cathédrale Saint-Jean-Baptiste</h3>
                    <p>Admirez ce magnifique édifice gothique méridional commencé au XIVe siècle.</p>
                </div>

                <div class="discover-card">
                    <img src="/public/images/perpignan-castillet.png" alt="Le Castillet">
                    <h3>Le Castillet</h3>
                    <p>Monument emblématique de Perpignan, cette ancienne porte fortifiée est aujourd'hui le Musée Casa Pairal.</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-logo">
                <h3>L'âme de Perpignan</h3>
                <p>Made in France</p>
            </div>

            <div class="footer-links">
                <div class="footer-column">
                    <h4>Navigation</h4>
                    <ul>
                        <li><a href="#accueil">Accueil</a></li>
                        <li><a href="#fonctionnalites">Fonctionnalités</a></li>
                        <li><a href="#itineraire">Itinéraire</a></li>
                        <li><a href="#decouvrir">Découvrir</a></li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Contact</h4>
                    <ul>
                        <li>Email: contact@amedeperp.fr</li>
                        <li>Téléphone: +33 4 XX XX XX XX</li>
                        <li>Adresse: Place de la Loge, 66000 Perpignan</li>
                    </ul>
                </div>

                <div class="footer-column">
                    <h4>Suivez-nous</h4>
                    <div class="social-icons">
                        <a href="#" class="social-icon">FB</a>
                        <a href="#" class="social-icon">IG</a>
                        <a href="#" class="social-icon">TW</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer-bottom">
            <p>&copy; 2025 L'âme de Perpignan. Tous droits réservés.</p>
        </div>
    </footer>

    <script src="/public/script.js"></script>
    <script>
        async function chargerStations() {
    try {
        const res = await fetch('/stations');
        const data = await res.json();
        const dataList = document.getElementById("dataSet");
        
        // Vider le datalist au cas où
        dataList.innerHTML = '';
        
        // Ajouter chaque station comme une option dans le datalist
        data.stations.forEach(s => {
            const option = document.createElement('option');
            option.value = s.name;
            option.setAttribute('data-id', s.id);
            dataList.appendChild(option);
        });
        } catch (error) {
            console.error("Erreur lors du chargement des stations:", error);
        }
    }

    async function trouverChemin() {
    // Obtenir les valeurs saisies dans les inputs
    const departValue = document.getElementById('depart').value;
    const arriveeValue = document.getElementById('arrivee').value;
    const eviterValue = document.getElementById('eviter').value;
    const intermediaireValue = document.getElementById('intermediaire').value;
    
    // Récupérer tous les options du datalist
    const options = document.querySelectorAll('#dataSet option');
    
    // Fonction pour trouver l'ID correspondant à un nom de station
    function findIdByName(name) {
        for (const option of options) {
            if (option.value === name) {
                return option.getAttribute('data-id');
            }
        }
        return null; // Retourne null si aucune correspondance n'est trouvée
    }
    
    // Récupérer les IDs correspondants aux valeurs saisies
    const departId = findIdByName(departValue);
    const arriveeId = findIdByName(arriveeValue);
    const eviterId = findIdByName(eviterValue);
    const intermediaireId = findIdByName(intermediaireValue);
    
    // Créer l'objet de paramètres pour la requête avec les IDs
    const params = new URLSearchParams({
        start: departId || "",
        end: arriveeId || "",
        eviter: eviterId || "",
        intermediaires: intermediaireId || ""
    });

    // ...début du code inchangé...

try {
    // Faire la requête à l'API
    const res = await fetch(`/route?${params.toString()}`);
    const data = await res.json();
    console.log(data);
    const chemin = document.getElementById('chemin');

    // Afficher le résultat ou l'erreur
        if (data.error) {
            chemin.innerHTML = `<strong style="color:red;">Erreur :</strong> ${data.error}`;
        } else {
            // Construire l'affichage du chemin
                chemin.innerHTML = `<h3>Itinéraire :</h3><ul>`;
                
                // Pour chaque étape du chemin, afficher le nom de la station et la ligne si disponible
                data.path.forEach(step => {
                    let ligneInfo = step.ligne ? ` (Ligne ${step.ligne})` : '';
                    chemin.innerHTML += `<li>${step.stationName}${ligneInfo}</li>`;
                });
                
                chemin.innerHTML += '</ul>';
            }
    } catch (error) {
        console.error("Erreur lors de la recherche du chemin:", error);
        document.getElementById('chemin').innerHTML = `<strong style="color:red;">Erreur :</strong> Impossible de récupérer l'itinéraire`;
    }
}

        window.onload = chargerStations;
    </script>
</body>
</html>